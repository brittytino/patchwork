name: Build and Release APK

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: gradle
          
      - name: Grant execute permission for gradlew
        run: chmod +x gradlew
        
      - name: Build Release APK
        run: ./gradlew assembleRelease --stacktrace
          
      - name: Rename APK
        run: |
          mv app/build/outputs/apk/release/app-release-unsigned.apk app/build/outputs/apk/release/patchwork-${{ github.ref_name }}.apk
          
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: app/build/outputs/apk/release/patchwork-${{ github.ref_name }}.apk
          generate_release_notes: true
          draft: false
          prerelease: false
          body: |
            ## Patchwork ${{ github.ref_name }}
            
            ### What's New
            - First official release üéâ
            - Complete app rename from Essentials to Patchwork
            - All features fully functional
            - 30+ languages supported
            
            ### Features
            - üõ†Ô∏è **Productivity & Tools**: Maps Power Saving, Travel Alarm, DIY Automation, Button Remap, App Freezing, and more
            - üîí **Security & Privacy**: App Lock, Screen Locked Security
            - üé® **Visual Customization**: Status Bar Icons, Notification Lighting, Dynamic Night Light
            - ‚ö° **Quick Settings Tiles**: 20+ useful system toggles
            - üéπ **Bonus**: Custom keyboard, Watermark, Batteries monitor
            
            ### Requirements
            - Android 8.0 (Oreo) or higher
            - Recommended: Android 13+ for full feature support
            - Optional: Shizuku or Root for advanced features
            
            ### Installation
            1. Download `patchwork-${{ github.ref_name }}.apk` below
            2. Enable "Install from unknown sources" in your device settings
            3. Install the APK
            4. Grant permissions as needed for features you want to use
            
            ### Developer
            Built with ‚ù§Ô∏è by [Tino Britty J](https://github.com/brittytino)
            
            ### Links
            - üìñ [Full Documentation](https://github.com/brittytino/patchwork/blob/main/README.md)
            - üí¨ [Telegram Community](https://t.me/tidwib)
            - üêõ [Report Issues](https://github.com/brittytino/patchwork/issues)
            
            ---
            
            **Note**: This app uses advanced system APIs. While designed for safety, some features are experimental. Use responsibly.
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
